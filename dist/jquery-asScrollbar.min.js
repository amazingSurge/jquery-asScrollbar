/*! asScrollbar - v0.1.0 - 2014-05-13
* https://github.com/amazingsurge/jquery-asScrollbar
* Copyright (c) 2014 JimbaChen; Licensed MIT */
(function(t){t.AsScrollable=function(e,s){var i,n=this.$container=t(s),e=this.options=t.extend(this.options,t.AsScrollable.defaults,e||{});"vertical"===this.options.direction?i=this.oriAttr={x:"Y",pos:"top",crossPos:"left",size:"height",crossSize:"width",client:"clientHeight",crossClient:"clientWidth",offset:"offsetHeight",crossOffset:"offsetWidth",offsetPos:"offsetTop",scroll:"scrollTop",scrollSize:"scrollHeight",overflow:"overflow-y",pageOffset:"pageYOffset",mouseAttr:"pageY"}:"horizontal"===this.options.direction&&(i=this.oriAttr={x:"X",pos:"left",crossPos:"top",size:"width",crossSize:"height",client:"clientWidth",crossClient:"clientHeight",offset:"offsetWidth",crossOffset:"offsetHeight",offsetPos:"offsetLeft",scroll:"scrollLeft",scrollSize:"scrollWidth",overflow:"overflow-x",pageOffset:"pageXOffset",mouseAttr:"pageX"});var r=this.$content=n.find("."+e.contentClass);0===r.length&&(n.wrapInner('<div class="'+e.contentClass+'"/>'),r=this.$content=n.find("."+e.contentClass));var o=this.$wrapper=n.find("."+e.wrapperClass);0===o.length&&(r.wrap('<div class="'+e.wrapperClass+'"/>'),o=this.$wrapper=r.parents("."+e.wrapperClass)),n.css({overflow:"hidden",position:"relative"});var a=o[0];r[0],o.css(i.overflow,"scroll").css(i.crossSize,a.parentNode[i.crossClient]+a[i.crossOffset]-a[i.crossClient]+"px"),r.css("overflow","hidden").css(i.crossSize,"auto"),this.origPosition=0,this.origHanlePosition=0,this.initLayout(),this.initEvent()},t.AsScrollable.prototype={initLayout:function(){var t=(this.oriAttr,this.options),e=this.$wrapper,s=(this.$content,this.$container);"horizontal"===t.direction?s.css("height",s.height()):e.css("height",s.height()),this.initBarLayout(),s.trigger(this.eventName("initLayout"))},initBarLayout:function(){var e=this.oriAttr,s=this.options,i=this.$wrapper,n=(this.$content,this.$container,this.$wrapper[0]),r=this.$content[0];container=this.$container[0],this.$bar===void 0&&(this.$bar=this.$container.find("."+s.barClass),0===this.$bar.length&&(this.$bar=t(s.barTmpl),this.$bar.appendTo(i)),this.$bar.addClass(s.direction).attr("draggable",!1));var o=this.$handle=this.$bar.find("."+s.handleClass),a=this.$bar[0],h=this.$handle[0],l=r[e.offset],c=n[e.client];if(l-c>0)if(o.css(e.size,a[e.client]*c/l),this.bLength===void 0){this.hLength=h[e.client],this.bLength=a[e.client]-this.hLength;var f=this.getPercentOffset();this.hPosition=f*this.bLength,0!==this.hPosition&&this.handleMove(this.hPosition,!1)}else{var p=this.bLength;this.hLength=h[e.client];var d=this.bLength=a[e.client]-this.hLength,g=this.getHanldeOffset();0!==g&&(g=g*d/p,g>d&&(g=d),this.$handle.css(e.pos,g))}else this.$bar.hide()},initEvent:function(){var e=(this.oriAttr,this),s=this.$wrapper,i=this.$container,n=this.$bar;s.on("scroll",function(){var s=e.getPercentOffset();t(this).trigger(e.eventName("change"),[s,"content"])}),n.on("mousedown",function(s){var i=e.oriAttr,n=e.bLength,r=e.hLength,o=e.$handle;if(e.hPosition=e.getHanldeOffset(),t(s.target).is(o))e.dragStart=s[i.mouseAttr],e.isDrag=!0,o.addClass("is-drag"),e.$bar.trigger(e.eventName("dragstart")),t(document).on(e.eventName("selectstart"),function(){return!1}),e.$container.css({"-moz-user-focus":"ignore","-moz-user-input":"disabled","-moz-user-select":"none"}),t(document).on(e.eventName("mousemove"),function(t){if(e.isDrag){var s=e.oriAttr,i=e.bLength,n=t[s.mouseAttr];start=e.dragStart;var r=e.hPosition+n-start;0>r?r=0:r>i&&(r=i),e.handleMove(r,!1,!0)}});else{var a=s[i.mouseAttr]-e.$bar.offset()[i.pos]-r/2;0>a?a=0:a>n&&(a=n),e.handleMove(a,!1,!0)}t(document).one(e.eventName("mouseup blur"),function(){e.$handle.removeClass("is-drag"),e.$bar.trigger("dragend."+e.options.namespace),e.isDrag=!1,t(document).off(e.eventName("selectstart mousemove")),e.$container.css({"-moz-user-focus":"inherit","-moz-user-input":"inherit","-moz-user-select":"inherit"})})}),i.on(this.eventName("change"),function(t,s,i){"bar"===i?e.move(s,!0):"content"===i&&e.handleMove(s,!0),0===s?e.$container.trigger(e.eventName("scrolltop")):1===s&&e.$container.trigger(e.eventName("scrollbottom"))}),this.options.responsive&&t(window).resize(function(){e.initLayout()})},getHanldeOffset:function(){return parseInt(this.$handle.css(this.oriAttr.pos).replace("px",""),10)},getContentOffset:function(){var t=this.oriAttr,e=this.$wrapper[0];return e[t.pageOffset]||e[t.scroll]},getPercentOffset:function(){var t=this.oriAttr,e=this.$wrapper[0],s=this.$content[0];return this.getContentOffset()/(s[t.client]-e[t.offset])},handleMove:function(t,e,s){var i,n=this.$handle,r={},o=this.bLength,a=this.oriAttr;$bar=this.$bar,e?(t*=o,i=t):i=t/o,r[a.pos]=t,n.css(r),s&&$bar.trigger(this.eventName("change"),[i,"bar"])},eventName:function(t){if("string"!=typeof t||""===t)return!1;for(var e=this.options.namespace,t=t.split(" "),s=t.length,i=0;s>i;i++)t[i]=t[i]+"."+e;return t.join(" ")},move:function(t,e){var s=this.oriAttr,i=this.$wrapper[0],n=this.$content[0];if(e){if(t>1||0>t)return!1;t=-t*(i[s.offset]-n[s.client])}i[s.scroll]=t},destory:function(){this.$bar.remove(),this.$container.html(this.$content.html()),this.$container.removeData("scroll")}},t.AsScrollable.defaults={contentClass:"content",wrapperClass:"wrapper",barClass:"scrollbar",barTmpl:'<div class="scrollbar"><div class="handle"></div></div>',handleClass:"handle",direction:"vertical",namespace:"asScrollable",responsive:!1},t.fn.asScrollable=function(e){if("string"==typeof e){var s=Array.prototype.slice.call(arguments,1);this.each(function(){var i=t(this).data("scroll");return i?t.isFunction(i[e])&&"_"!==e.charAt(0)?(i[e].apply(i,s),void 0):!1:!1})}else this.each(function(){t(this).data("scroll")||t(this).data("scroll",new t.AsScrollable(e,this))});return this}})(jQuery);